<!DOCTYPE html>
<html layout:decorate="~{layout}" 
      xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <title>Account</title>

  <!-- ✅ Local Bootstrap CSS -->
  <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet" />
 <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <!-- ✅ Local Font Awesome (from /static/fontawesome) -->
  <link th:href="@{/fontawesome/css/fontawesome.css}" rel="stylesheet" />
  <link th:href="@{/fontawesome/css/brands.css}" rel="stylesheet" />
  <link th:href="@{/fontawesome/css/solid.css}" rel="stylesheet" />
  <!-- OR use all.css if you want everything in one -->
  <!-- <link th:href="@{/fontawesome/css/all.css}" rel="stylesheet" /> -->

  <!-- ✅ Local jQuery -->
  <script th:src="@{/js/jquery-3.6.0.min.js}"></script>

  <!-- ✅ Local Bootstrap Bundle JS (includes Popper) -->
  <script th:src="@{/js/bootstrap.bundle.min.js}"></script>
</head>

  <style>
    .profile-card {
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
      padding: 20px;
    }
    .profile-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #0d6efd;
    }
    .form-label {
      font-weight: 600;
    }
    .btn-primary {
      background: linear-gradient(90deg, #0d6efd, #0a58ca);
      border: none;
    }
    .btn-primary:hover {
      background: linear-gradient(90deg, #0a58ca, #084298);
    }
    .input-group-text {
      cursor: pointer;
    }
  </style>
</head>
<body>
<div layout:fragment="content" class="container py-4">
  <div class="row g-4">
    <!-- Profile summary -->
    <div class="col-md-4">
      <div class="profile-card text-center">
        <img src="https://via.placeholder.com/120" alt="Avatar" class="profile-avatar mb-3">
        <h5 class="mb-0" th:text="${user.firstName} + ' ' + ${user.lastName}">John Doe</h5>
        <p class="text-muted" th:text="${user.email}">john@example.com</p>
        <span class="badge bg-primary" th:text="${user.username}">admin</span>
      </div>
    </div>

    <!-- Edit form -->
    <div class="col-md-8">
      <div class="profile-card">
        <h5 class="card-title mb-3"><i class="fas fa-user-edit me-2"></i>Edit Account</h5>
        <form th:action="@{/account}" th:object="${user}" method="post" class="needs-validation" novalidate>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="username" class="form-label">Username</label>
              <input type="text" class="form-control" id="username" th:field="*{username}" th:errorclass="is-invalid">
              <div class="invalid-feedback" th:if="${#fields.hasErrors('username')}" th:errors="*{username}"></div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="email" class="form-label">Email</label>
              <input type="email" class="form-control" id="email" th:field="*{email}" th:errorclass="is-invalid">
              <div class="invalid-feedback" th:if="${#fields.hasErrors('email')}" th:errors="*{email}"></div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-6 mb-3">
              <label for="firstName" class="form-label">First Name</label>
              <input type="text" class="form-control" id="firstName" th:field="*{firstName}" th:errorclass="is-invalid">
              <div class="invalid-feedback" th:if="${#fields.hasErrors('firstName')}" th:errors="*{firstName}"></div>
            </div>
            <div class="col-md-6 mb-3">
              <label for="lastName" class="form-label">Last Name</label>
              <input type="text" class="form-control" id="lastName" th:field="*{lastName}" th:errorclass="is-invalid">
              <div class="invalid-feedback" th:if="${#fields.hasErrors('lastName')}" th:errors="*{lastName}"></div>
            </div>
          </div>

          <!-- Password field for Admin only -->
          <div sec:authorize="hasRole('ADMIN')" class="mb-3">
            <label for="password" class="form-label">Password</label>
            <div class="input-group">
              <input type="password" class="form-control" id="password" th:field="*{password}" th:errorclass="is-invalid">
              <span class="input-group-text" id="togglePassword"><i class="fas fa-eye"></i></span>
            </div>
            <div class="invalid-feedback" th:if="${#fields.hasErrors('password')}" th:errors="*{password}"></div>
          </div>

          <input type="hidden" th:field="*{id}">
          <button sec:authorize="hasRole('ADMIN')" type="submit" class="btn btn-primary px-4">Update Info</button>
        </form>
      </div>
    </div>
  </div>
</div>

<script>
  // Toggle password visibility
  document.getElementById("togglePassword").addEventListener("click", function () {
    const passwordField = document.getElementById("password");
    const icon = this.querySelector("i");
    if (passwordField.type === "password") {
      passwordField.type = "text";
      icon.classList.replace("fa-eye", "fa-eye-slash");
    } else {
      passwordField.type = "password";
      icon.classList.replace("fa-eye-slash", "fa-eye");
    }
  });
</script>
</body>
</html>
