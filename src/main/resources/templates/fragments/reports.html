<!DOCTYPE html>
<html layout:decorate="~{layout}">
<head>
    <title>Reports</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<div layout:fragment="content" class="container">

    <h3 class="mb-4">Generate Reports</h3>

    <form id="reportForm" class="row g-3 mb-4" action="javascript:void(0);">
        <div class="col-md-3">
            <label for="fromDate" class="form-label">From Date</label>
            <input type="date" class="form-control" id="fromDate" name="fromDate" required>
        </div>
        <div class="col-md-3">
            <label for="toDate" class="form-label">To Date</label>
            <input type="date" class="form-control" id="toDate" name="toDate" required>
        </div>
        <div class="col-md-3">
            <label for="reportType" class="form-label">Report Type</label>
            <select class="form-select" id="reportType" name="reportType" required>
                <option value="">Select Type</option>
                <option value="stock">Stock</option>
                <option value="sales">Sales</option>
                <option value="customer">Customer</option>
            </select>
        </div>
        <div class="col-md-3 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Generate</button>
        </div>
    </form>

    <!-- Report Modal -->
    <div class="modal fade" id="reportModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Report</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="reportModalBody">
                    <!-- Report content will be loaded here via AJAX -->
                </div>
            </div>
        </div>
    </div>

</div>

<th:block layout:fragment="scripts">
<script>
$(document).ready(function() {
    console.log("DOM ready - script loaded");

    $('#reportForm').on('submit', function(e) {
        e.preventDefault();

        const fromDate = $('#fromDate').val();
        const toDate = $('#toDate').val();
        const reportType = $('#reportType').val();

        if(!fromDate || !toDate || !reportType) {
            alert("Please fill all fields");
            return;
        }

        const url = `/reports/view?from=${fromDate}&to=${toDate}&type=${reportType}`;
        console.log("AJAX request to:", url);

        $.get(url, function(html) {
            $('#reportModalBody').html(html);
            const modalEl = document.getElementById('reportModal');
            const modal = new bootstrap.Modal(modalEl);
            modal.show();
        }).fail(function() {
            alert("Failed to load report. Check console for errors.");
        });
    });
});
</script>
</th:block>


</body>
</html>
